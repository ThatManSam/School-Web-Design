<!DOCTYPE html>
<html>
<head>
    <title>This is the Title</title>
    <meta charset="UFT-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,400i,700,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:100,300,400,400i,700,900" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body onload="contructItemList()">
<header>
    <div class="header-title">
        <div class="wrapper">
            <div id="menu-trigger">
                <a onclick="openMenuSidebar()">&#9776;</a>
            </div>
            <a href="index.html"><div id="header-image"><img src="images/greek-lamb-pizza.jpg"/></div>
            <h1>PIZZA TO GO</h1></a>
        </div>
    </div>
    <div class="wrapper">
        <script>
        function openMenuSidebar() {
            document.getElementById("header-navigation").style.left = "0";
            document.getElementById("navCloseButton").style.display = "block";
        }

        function closeMenuSidebar() {
            document.getElementById("header-navigation").style.left = "-250px";
            document.getElementById("navCloseButton").style.display = "none";
        }

        function widthTest() {
            console.log("Width Test");
            var width = window.innerWidth;
            if(width >= 600) {
                closeMenuSidebar();
            }
        }
        </script>
        <nav id="header-navigation">
            <a id="navCloseButton" onclick="closeMenuSidebar()">&times;</a>
            <ul>
                <li><a href="index.html"><div>HOME</div></a></li>
                <li><a href="order.html"><div>PLACE AN ORDER</div></a></li>
                <li><a href="contact.html"><div>CONTACT</div></a></li>
            </ul>
        </nav>
    </div>
</header>

<section>
<script>
var cart = [];
var items = [];
var itemNum = 0;

//adding items to the items[] array based on items in the HTML code
function contructItemList() {
    var i;
    for (i=0; document.getElementById("item-"+i) !== null; i++) {//each item added as an object with some properties
        items.push({
            "id": i, 
            "name": document.getElementById("item-" + i).getAttribute("data-name"), 
            "price": Number(document.getElementById("item-" + i).getAttribute("data-price"))
        });
    }
    console.log(items);
}

function cartListContructor(index, create) {
    var newCartItem;
    var currentItem;
    itemId = function() {
        for(i=0; i < cart.length; i++) {
            if(cart[i].id === index) {
            return i;
            }
        }
        return -1;
    }
    var id = itemId();
    if(create) {
        newCartItem = document.createElement("li"); //Creating a new <li> tag for a new item added to the cart
        newCartItem.setAttribute("id", "cart-" + index);
        console.log(index);
        newCartItem.innerHTML = //The HTML code to be added for the new cart
            '<button type="button" name="cart-'+ index +'" onclick="removeItem('+ index +')">X</button><p id="cart-item">'+cart[id].name+' x <a id="quantity">'+cart[id].quantity+'</a></p>';
        document.getElementById("cart-list").appendChild(newCartItem);
    
    } else {
        currentItem = document.getElementById("cart-" + index);
        currentItem.querySelector("#quantity").innerHTML = cart[id].quantity;
    }
}

function addItem(item) {
    var itemName = items[item].name;
    var itemId = items[item].id;
    var create;
    var index = function() {
        for(i=0; i < cart.length; i++) {
            if(cart[i].name === itemName) {
            return i;
            }
        }
        return -1;
    }
    var cartIndex = index();
    if(cartIndex !== -1) {
        cart[cartIndex].quantity += 1;
        create = false;
    } else {
        cart.push({
            "id": itemId,
            "name": itemName,
            "quantity": 1
        });
        create = true;
        console.log(cart);
    }
    cartListContructor(itemId, create);
}

//Removing an product from the cart / array cart[] and removing it from the HTML cart list
function removeItem(index) {
    var itemId = function() {
        for(i=0; i < cart.length; i++) {
            if(cart[i].id === index) {
            return i;
            }
        }
        return -1;
    }
    var id = itemId();
    if(id === -1) {
        console.log("Cannot remove item that doesn't exist     "+index);
        console.log(cart);
        return;
    } else {
    if(cart[id].quantity === 1) {
        deletedItem = document.getElementById("cart-" + index);
        deletedItem.parentNode.removeChild(deletedItem);
        cart.splice(id, 1);
    } else {
        cart[id].quantity = cart[id].quantity - 1;
        currentItem = document.getElementById("cart-" + index);
        currentItem.querySelector("#quantity").innerHTML = cart[id].quantity;
    }
    console.log(cart);
    }
}

function submitOrder() {
    if(cart.length === 0) {
        alert("You must order some items to submit");
        window.reload();
    }
    var totalPrice = 0;
    var price;
    var quantity;
    var i;
    var a;
    for(a=0; a < cart.length; a++) {
        id = cart[a].id;
        itemsId = function(cartId) {
            for(i=0; i < items.length; i++) {
                if(items[i].id === cartId) {
                return i;
                }
            }
        }
        price = Number(items[itemsId(id)].price);
        quantity = Number(cart[a].quantity);
        totalPrice += (price * quantity);
    }
    console.log("Total Price: " + totalPrice); 
    orderPlaced(totalPrice);
}

function orderPlaced(totalPrice) {
    var appendNode = document.createElement("tbody");
    appendNode.innerHTML = '<tbody><tr><th class="table-name">Item</th><th class="table-quantity">Quantity</th><th class="table-cost">Cost</th></tr>';
    var name;
    var singlePrice;
    var price;
    var quantity;
    var i;
    var a;
    for(a=0; a < cart.length; a++) {
        id = cart[a].id;
        itemsId = function(cartId) {
            for(i=0; i < items.length; i++) {
                if(items[i].id === cartId) {
                return i;
                }
            }
        }
        name = items[itemsId(id)].name;
        singlePrice = items[itemsId(id)].price;
        quantity = cart[a].quantity;
        price = singlePrice * quantity;

        var dataNode = document.createElement("tr");
        dataNode.innerHTML = '<td class="table-name">'+name+'</td><td class="table-quantity">'+quantity+'</td><td class="table-price">$'+price+'</td>';
        appendNode.appendChild(dataNode);
    }
    var totalQuantity = 0;
    for(a=0; a < cart.length; a++) {
        totalQuantity += cart[a].quantity;
    }
    
    var totalNode = document.createElement("tr");
    totalNode.style.fontWeight = "500";
    totalNode.innerHTML = '<td class="table-name">Total</td><td class="table-quantity">'+Number(totalQuantity)+'</td><td class="table-price">$'+totalPrice+'</td>';
    appendNode.appendChild(totalNode);

    document.getElementById("order-display-table").appendChild(appendNode);

    document.getElementById("order-form").style.display = "none";
    document.getElementById("cart").style.display = "none";
    document.getElementById("order-display").style.display = "block";
}

function confirmOrder() {
    document.getElementById("order-display").style.display = "none";
    document.getElementById("order-message").style.display = "block";
    var newMeta = document.createElement("meta");
    var newAttribute = document.createAttribute("http-equiv");
    var newAttribute2 = document.createAttribute("content");
    newAttribute.value = "refresh";
    newAttribute2.value = "10";
    newMeta.setAttributeNode(newAttribute);
    newMeta.setAttributeNode(newAttribute2);
    document.getElementsByTagName("head")[0].appendChild(newMeta);
}

function changeOrder() {
    document.getElementById("order-form").style.display = "block";
    document.getElementById("cart").style.display = "block";
    document.getElementById("order-display").style.display = "none";
}

function cancelOrder() {
    location.reload();
}
</script>
<div class="wrapper">
<div class="para-with-title">
    <h2>This is a Heading 2</h2>    
    <p>
        This is text in the paragraph with title. aliquam augue ante, quis vestibulum lorem posuere ut. Fusce blandit neque lorem, eget euismod quam viverra in. Fusce imperdiet risus odio, vel pulvinar magna blandit eget. Quisque aliquet at est posuere porta. Praesent volutpat, arcu non elementum bibendum, ipsum urna pretium dolor, eget accumsan odio sapien id orci. Vivamus nunc turpis, ornare semper velit eu, lacinia 
    </p>
</div>
<div id="cart">
    <h3>Cart:</h3>
    <ul id="cart-list">
    </ul>
    <div id="cart-submit">
    <button type="submit" name="submit" onclick="submitOrder()">SUBMIT</button>
    </div>
</div>
<div id="order-form">
<form name="order-form">
    <table>
        <tr>
            <td>
                <div id="item-0" data-name="Greek Lamb Pizza" data-price="10" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Greek Lamb Pizza</p>
                    <button type="button" name="item-0" onclick="addItem(0)" >ADD TO CART</button>
                </div>
            </td>
            <td>
                <div id="item-1" data-name="Meat Lovers Pizza" data-price="10" style="background-image: url(images/meat-lovers-pizza.jpg)"> 
                    <p>Meat Lovers Pizza</p>
                    <button type="button" name="item-1" onclick="addItem(1)">ADD TO CART</button>   
                </div>
            </td>
            <td>
                <div id="item-2" data-name="Hawaiian Pizza" data-price="12.50" style="background-image: url(images/hawaiian-pizza.jpg)"> 
                    <p>Hawaiian Pizza</p>
                    <button type="button" name="item-2" onclick="addItem(2)">ADD TO CART</button>   
                </div>
            </td>
            <td>
                <div id="item-3" data-name="Supreme Pizza" data-price="12.50" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Supreme Pizza</p>
                    <button type="button" name="item-3" onclick="addItem(3)">ADD TO CART</button>   
                </div>
            </td>
            <td>
                <div id="item-4" data-name="Garlic Pizza" data-price="10" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Garlic Pizza</p>
                    <button type="button" name="item-4" onclick="addItem(4)">ADD TO CART</button>
                </div>
            </td>
            <td>
                <div id="item-5" data-name="Cheese Pizza" data-price="10" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Cheese Pizza</p>
                    <button type="button" name="item-5" onclick="addItem(5)">ADD TO CART</button>   
                </div>
            </td>
            <td>
                <div id="item-6" data-name="Vegetarian Pizza" data-price="12.50" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Vegetarian Pizza</p>
                    <button type="button" name="item-6" onclick="addItem(6)">ADD TO CART</button>   
                </div>
            </td>
            <td>
                <div id="item-7" data-name="Double Cheese Pizza" data-price="12.50" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Double Cheese Pizza</p>
                    <button type="button" name="item-7" onclick="addItem(7)">ADD TO CART</button>   
                </div>
            </td>
            <td>
                <div id="item-8" data-name="Spicy Pork Pizza" data-price="10" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Spicy Pork Pizza</p>
                    <button type="button" name="item-8" onclick="addItem(8)">ADD TO CART</button>
                </div>
            </td>
            <td>
                <div id="item-9" data-name="Original Pizza" data-price="10" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Original Pizza</p>
                    <button type="button" name="item-9" onclick="addItem(9)">ADD TO CART</button>   
                </div>
            </td>
            <td>
                <div id="item-10" data-name="Chicken Pizza" data-price="12.50" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Chicken Pizza</p>
                    <button type="button" name="item-10" onclick="addItem(10)">ADD TO CART</button>   
                </div>
            </td>
            <td>
                <div id="item-11" data-name="Dessert Pizza" data-price="12.50" style="background-image: url(images/greek-lamb-pizza.jpg)"> 
                    <p>Dessert Pizza</p>
                    <button type="button" name="item-11" onclick="addItem(11)">ADD TO CART</button>   
                </div>
            </td>
        </tr>
    </table>
</form>
</div>
<div id="order-display">
    <h3>Your Order: </h3>
    <table id="order-display-table">
    </table>
    <button id="confirm-button" name="confirm" onclick="confirmOrder()">CONFIRM</button>
    <button id="cancel-button" name="cancel" onclick="cancelOrder()">CANCEL</button>
    <button id="change-button" name="change" onclick="changeOrder()">CHANGE</button>
    <p>Please pay on pickup.  Thanks!</p>
</div>
<div id="order-message">
    <h3>Thanks You</h3>
    <p>
        Your order has been placed and will be ready in 15 minutes. <br />
        Please pay on pickup
    </p>
</div>
</div>
</section>
<footer>
<div class="wrapper" style="background-color: inherit">
    <nav>
        <ul>
            <li><a href="index.html">HOME</a></li>
            <li><a href="order.html">PLACE AN ORDER</a></li>
            <li><a href="contact.html">CONTACT</a></li>
        </ul> 
    </nav>
</div>
</footer>
</body>
</html>